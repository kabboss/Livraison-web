<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="SEND 2.0 - Suivi de colis ultra-sophistiqué nouvelle génération">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SEND 2.0 | Suivi Colis Intelligent</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            /* Couleurs modernes */
            --primary: #667eea;
            --primary-dark: #4c63d2;
            --primary-light: #818cf8;
            --secondary: #10B981;
            --accent: #F59E0B;
            --danger: #EF4444;
            --success: #22C55E;
            --warning: #F59E0B;
            --info: #3B82F6;
            --white: #FFFFFF;
            --black: #000000;
            
            /* Nuances de gris */
            --gray-50: #F8FAFC;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E1;
            --gray-400: #94A3B8;
            --gray-500: #64748B;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1E293B;
            --gray-900: #0F172A;
            
            /* Effets */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.25);
            --shadow-2xl: 0 24px 64px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 30px rgba(102, 126, 234, 0.4);
            
            /* Border radius */
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-3xl: 28px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* Backdrop blur */
            --backdrop-blur: blur(20px);
            --backdrop-blur-strong: blur(40px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 50%, #2D1B69 100%);
            min-height: 100vh;
            color: var(--gray-800);
            overflow-x: hidden;
            font-weight: 400;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            padding-top: 80px;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.4) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.25) 0%, transparent 60%),
                radial-gradient(circle at 60% 80%, rgba(37, 211, 102, 0.1) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Navigation flottante */
        .floating-nav {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-xl);
            animation: navSlideDown 0.8s ease-out;
        }

        @keyframes navSlideDown {
            from { opacity: 0; transform: translateY(-100%); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--white);
        }

        .nav-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: var(--shadow);
        }

        .nav-title {
            font-size: 1.9rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .nav-actions {
            display: flex;
            gap: 12px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--white);
            padding: 10px 16px;
            border-radius: var(--radius-xl);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, var(--secondary), #059669);
            border: none;
        }

        /* Container principal */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Header de recherche */
        .search-header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out;
        }

        .header-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 2rem;
            color: var(--white);
            box-shadow: var(--shadow-2xl);
            border: 3px solid rgba(255, 255, 255, 0.25);
            animation: iconFloat 6s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 12px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            letter-spacing: -2px;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 50%, #c7d2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* Carte de recherche */
        .search-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-2xl);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: slideInUp 0.6s ease-out 0.2s both;
            position: relative;
            overflow: hidden;
        }

        .search-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--secondary), var(--primary));
            background-size: 300% 100%;
            animation: gradientFlow 4s ease-in-out infinite;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-input {
            width: 100%;
            padding: 20px 24px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-2xl);
            font-size: 1.1rem;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            text-align: center;
            text-transform: uppercase;
            transition: var(--transition);
            background: var(--white);
            color: var(--gray-800);
            box-shadow: var(--shadow-sm);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.98);
        }

        .form-input::placeholder {
            color: var(--gray-400);
            font-weight: 400;
            letter-spacing: 1px;
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            border: none;
            padding: 20px 32px;
            border-radius: var(--radius-2xl);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            min-height: 70px;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .search-btn:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2xl);
            filter: brightness(1.05);
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:active {
            transform: translateY(-2px);
        }

        .search-btn.loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Section des résultats */
        .results-section {
            display: none;
            animation: resultsSlideIn 0.8s ease-out;
        }

        .results-section.visible {
            display: block;
        }

        @keyframes resultsSlideIn {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-container {
            display: grid;
            gap: 24px;
        }

        /* Carte de statut */
        .status-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            padding: 32px;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success), var(--secondary), var(--warning));
            animation: statusPulse 3s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .status-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--success), var(--secondary));
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--white);
            box-shadow: var(--shadow-lg);
            animation: statusBounce 2s ease-in-out infinite;
        }

        @keyframes statusBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .status-info h2 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .status-description {
            color: var(--gray-600);
            font-size: 1rem;
            line-height: 1.6;
        }

        .tracking-code-display {
            background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
            border: 2px solid var(--primary);
            border-radius: var(--radius-2xl);
            padding: 20px;
            text-align: center;
            margin: 24px 0;
            position: relative;
            overflow: hidden;
        }

        .tracking-code-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            animation: codeShine 3s ease-in-out infinite;
        }

        @keyframes codeShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .code-label {
            font-size: 0.9rem;
            color: var(--gray-600);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .code-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary);
            font-family: 'Courier New', monospace;
            letter-spacing: 4px;
        }

        /* Profil du livreur ultra-sophistiqué */
        .driver-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            padding: 32px;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .driver-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--warning), var(--accent));
            animation: driverPulse 2s ease-in-out infinite;
        }

        @keyframes driverPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .driver-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .driver-header-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--warning), var(--accent));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .driver-header h3 {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--gray-800);
            margin: 0;
        }

        .driver-profile {
            display: flex;
            gap: 24px;
            align-items: center;
            flex-wrap: wrap;
        }

        .driver-avatar {
            width: 120px;
            height: 120px;
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-xl);
            border: 4px solid var(--white);
            flex-shrink: 0;
            background: linear-gradient(135deg, var(--gray-200), var(--gray-300));
        }

        .driver-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .driver-avatar:hover img {
            transform: scale(1.1);
        }

        .driver-avatar-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--white);
        }

        .driver-details {
            flex: 1;
            min-width: 200px;
        }

        .driver-name {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--gray-800);
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .driver-info-grid {
            display: grid;
            gap: 12px;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .driver-info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: var(--transition);
        }

        .driver-info-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .driver-info-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .driver-info-content {
            flex: 1;
        }

        .driver-info-label {
            font-size: 0.8rem;
            color: var(--gray-500);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .driver-info-value {
            font-size: 1rem;
            color: var(--gray-800);
            font-weight: 600;
        }

        .driver-badges {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .driver-badge {
            background: linear-gradient(135deg, var(--success), #16A34A);
            color: var(--white);
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow);
        }

        .driver-badge.verified {
            background: linear-gradient(135deg, var(--info), #1E40AF);
        }

        .driver-badge.pro {
            background: linear-gradient(135deg, var(--warning), #D97706);
        }

        /* Grille d'informations */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            padding: 24px;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .info-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2xl);
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .info-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .info-card-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .info-card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .info-items {
            display: grid;
            gap: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .info-value {
            font-size: 1rem;
            color: var(--gray-800);
            font-weight: 600;
            text-align: right;
        }

        .info-value.code {
            font-family: 'Courier New', monospace;
            color: var(--primary);
            font-weight: 800;
            letter-spacing: 1px;
        }

        .info-value.status {
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-en-cours {
            background: linear-gradient(135deg, var(--warning), #D97706);
            color: var(--white);
        }

        .status-livre {
            background: linear-gradient(135deg, var(--success), #16A34A);
            color: var(--white);
        }

        .status-en-attente {
            background: linear-gradient(135deg, var(--gray-400), var(--gray-500));
            color: var(--white);
        }

        /* Timeline ultra-moderne */
        .timeline-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            padding: 32px;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .timeline-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--info), var(--primary));
        }

        .timeline-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .timeline-header-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--info), var(--primary));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .timeline-header h3 {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--gray-800);
            margin: 0;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: var(--radius-full);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 32px;
            animation: timelineSlideIn 0.6s ease-out forwards;
            opacity: 0;
        }

        .timeline-item:nth-child(1) { animation-delay: 0.1s; }
        .timeline-item:nth-child(2) { animation-delay: 0.2s; }
        .timeline-item:nth-child(3) { animation-delay: 0.3s; }
        .timeline-item:nth-child(4) { animation-delay: 0.4s; }

        @keyframes timelineSlideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .timeline-marker {
            position: absolute;
            left: -32px;
            top: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--white);
            font-weight: 700;
            box-shadow: var(--shadow);
            z-index: 2;
        }

        .timeline-marker.completed {
            background: linear-gradient(135deg, var(--success), #16A34A);
        }

        .timeline-marker.current {
            background: linear-gradient(135deg, var(--warning), #D97706);
            animation: currentPulse 2s ease-in-out infinite;
        }

        .timeline-marker.pending {
            background: linear-gradient(135deg, var(--gray-400), var(--gray-500));
        }

        @keyframes currentPulse {
            0%, 100% { transform: scale(1); box-shadow: var(--shadow); }
            50% { transform: scale(1.1); box-shadow: var(--shadow-glow); }
        }

        .timeline-content {
            background: rgba(102, 126, 234, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.1);
            border-radius: var(--radius-2xl);
            padding: 20px;
            position: relative;
            transition: var(--transition);
        }

        .timeline-content:hover {
            background: rgba(102, 126, 234, 0.08);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .timeline-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .timeline-description {
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .timeline-date {
            font-size: 0.9rem;
            color: var(--gray-500);
            font-weight: 600;
        }

        /* Carte interactive */
        .map-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-3xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 24px;
        }

        .map-header {
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--gray-200);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(102, 126, 234, 0.02));
        }

        .map-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .map-header-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--info), var(--primary));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .map-header h3 {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--gray-800);
            margin: 0;
        }

        .map-controls {
            display: flex;
            gap: 8px;
        }

        .map-control-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--gray-200);
            color: var(--gray-600);
            padding: 8px 16px;
            border-radius: var(--radius-xl);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-control-btn:hover,
        .map-control-btn.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        #interactiveMap {
            height: 400px;
            width: 100%;
        }

        .map-legend {
            padding: 20px 32px;
            background: rgba(102, 126, 234, 0.02);
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--gray-700);
            font-weight: 500;
        }

        .legend-marker {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            box-shadow: var(--shadow-sm);
        }

        .legend-marker.sender { background: var(--info); }
        .legend-marker.receiver { background: var(--success); }
        .legend-marker.driver { background: var(--warning); }

        /* Boutons d'action */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .action-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            border: none;
            padding: 16px 24px;
            border-radius: var(--radius-2xl);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-2xl);
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn.success {
            background: linear-gradient(135deg, var(--success), #16A34A);
        }

        .action-btn.warning {
            background: linear-gradient(135deg, var(--warning), #D97706);
        }

        .action-btn.info {
            background: linear-gradient(135deg, var(--info), #1E40AF);
        }

        /* Messages d'erreur */
        .error-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 2px solid rgba(239, 68, 68, 0.2);
            border-radius: var(--radius-3xl);
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
            display: none;
            animation: errorSlideIn 0.6s ease-out;
        }

        .error-card.visible {
            display: block;
        }

        @keyframes errorSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .error-icon {
            font-size: 3rem;
            color: var(--danger);
            margin-bottom: 16px;
            animation: errorShake 0.6s ease-in-out;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .error-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--danger);
            margin-bottom: 12px;
        }

        .error-message {
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Messages de chargement */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(102, 126, 234, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .loading-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        .loading-spinner-large {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s linear infinite;
            margin-bottom: 24px;
        }

        .loading-message {
            color: var(--white);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
        }

        .loading-submessage {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            text-align: center;
            max-width: 300px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            border-radius: var(--radius-2xl);
            padding: 16px 24px;
            box-shadow: var(--shadow-2xl);
            border-left: 4px solid var(--primary);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 90%;
            min-width: 300px;
            animation: toastSlideIn 0.4s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes toastSlideIn {
            from { opacity: 0; transform: translateX(-50%) translateY(100%); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--info); }

        .toast-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }
        .toast.info .toast-icon { color: var(--info); }

        .toast-message {
            font-weight: 600;
            color: var(--gray-800);
            flex: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 100px;
            }

            .floating-nav {
                flex-direction: column;
                gap: 12px;
                padding: 20px;
            }

            .nav-actions {
                width: 100%;
                justify-content: center;
            }

            .container {
                padding: 16px;
            }

            .header-title {
                font-size: 2rem;
            }

            .header-subtitle {
                font-size: 1rem;
            }

            .search-card,
            .status-card,
            .driver-card,
            .info-card,
            .timeline-card,
            .map-card {
                padding: 24px;
                margin-bottom: 20px;
            }

            .driver-profile {
                flex-direction: column;
                text-align: center;
            }

            .driver-avatar {
                align-self: center;
            }

            .driver-info-grid {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .action-buttons {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .map-header {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }

            .map-controls {
                width: 100%;
                justify-content: center;
            }

            .map-legend {
                flex-direction: column;
                gap: 12px;
            }

            #interactiveMap {
                height: 300px;
            }

            .timeline {
                padding-left: 30px;
            }

            .timeline::before {
                left: 15px;
            }

            .timeline-marker {
                left: -27px;
                width: 20px;
                height: 20px;
                font-size: 0.7rem;
            }

            .form-input {
                padding: 18px 20px;
                font-size: 1rem;
            }

            .search-btn,
            .action-btn {
                padding: 16px 20px;
                font-size: 1rem;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .header-icon {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            .header-title {
                font-size: 1.8rem;
            }

            .driver-avatar {
                width: 100px;
                height: 100px;
            }

            .status-icon,
            .info-card-icon,
            .timeline-header-icon,
            .driver-header-icon,
            .map-header-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .map-legend {
                padding: 16px 20px;
            }

            .toast {
                min-width: 280px;
                margin: 0 16px;
            }
        }

        /* Animations d'entrée pour les éléments */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Amélioration de l'accessibilité */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles pour l'accessibilité */
        button:focus-visible,
        input:focus-visible,
        a:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Animations de performance optimisées */
        .will-change-transform {
            will-change: transform;
        }

        .will-change-opacity {
            will-change: opacity;
        }

        /* Styles d'impression */
        @media print {
            .floating-nav,
            .search-card,
            .action-buttons,
            .loading-overlay,
            .toast {
                display: none !important;
            }

            .results-section {
                background: white;
                color: black;
                box-shadow: none;
            }
        }



        /* Ajouter dans la section CSS */
.map-card.fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1001;
    border-radius: 0;
    margin: 0;
    animation: none;
}

.map-card.fullscreen #interactiveMap {
    height: calc(100vh - 120px);
}

.map-card.fullscreen .map-header {
    padding: 16px 24px;
}

.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: none;
}

.fullscreen-overlay.visible {
    display: block;
}

/* Animation pour le mode plein écran */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: scale(0.9); }
    to { transform: scale(1); }
}







.map-card.fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1001;
    border-radius: 0;
    margin: 0;
    background-color: #1a1a1a; /* fond sombre */
    animation: fadeIn 0.3s ease-out, zoomIn 0.3s ease-out;
    display: flex;
    flex-direction: column;
}











.status-card.waiting {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(255, 255, 255, 0.95));
    border-left: 8px solid var(--warning);
}

.status-icon.waiting {
    background: linear-gradient(135deg, var(--warning), #D97706);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.waiting-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    margin: 20px 0;
    background: rgba(251, 191, 36, 0.05);
    border-radius: var(--radius-xl);
    border: 1px dashed var(--warning);
}

.waiting-animation-icon {
    font-size: 3rem;
    color: var(--warning);
    margin-bottom: 15px;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}






.image-modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    animation: fadeIn 0.3s ease-out;
}

.image-modal-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
}

.image-modal-content img {
    max-width: 100%;
    max-height: 100%;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

.image-modal-content .close-button {
    position: absolute;
    top: -10px;
    right: -10px;
    background: white;
    color: black;
    border-radius: 50%;
    font-size: 24px;
    padding: 5px 10px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}


    </style>
</head>

<body>






<!-- Menu Hamburger -->
<div class="menu-btn" id="menuBtn">
    <i class="fas fa-bars"></i>
</div>

<div class="menu-overlay" id="menuOverlay"></div>

<div class="menu-drawer" id="menuDrawer">
    <div class="menu-header">
        <img src="img/ChatGPT Image 30 avr. 2025, 20_34_02.png" alt="SEND Logo" class="menu-logo">
        <span class="menu-title">SEND 2.0</span>
        <i class="fas fa-times menu-close" id="menuClose"></i>
    </div>
    
    <ul class="menu-list">
        <li class="menu-item"><a href="index.html" class="menu-link"><i class="fas fa-home"></i> Accueil</a></li>
        <li class="menu-item"><a href="client.html" class="menu-link"><i class="fas fa-shopping-bag"></i> Recevoir</a></li>
        <li class="menu-item"><a href="expediteur.html" class="menu-link"><i class="fas fa-paper-plane"></i> Expédier</a></li>
        <li class="menu-item"><a href="suivi.html" class="menu-link"><i class="fas fa-search-location"></i> Suivi de colis</a></li>
        <li class="menu-item"><a href="inscription_restau.html" class="menu-link"><i class="fas fa-utensils"></i> Partenariat Restaurant</a></li>
        <li class="menu-item"><a href="services.html" class="menu-link"><i class="fas fa-concierge-bell"></i> Services</a></li>
        <li class="menu-item"><a href="inscription.html" class="menu-link"><i class="fas fa-motorcycle"></i> Devenir Livreur</a></li>
        <li class="menu-item"><a href="Connection.html" class="menu-link"><i class="fas fa-sign-in-alt"></i> Connexion Livreur</a></li>
        <li class="menu-item"><a href="assistance.html" class="menu-link"><i class="fas fa-headset"></i> Assistance</a></li>
    </ul>

    <div class="menu-footer">
        SEND 2.0 &copy; 2025<br>
        Tous droits réservés
    </div>
</div>

<style>
    /* ====== Menu Hamburger ====== */
.menu-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 9000;
    background:#F59E0B;
    color: white;
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
    border: none;
}

.menu-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(5px);
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.menu-overlay.active {
    opacity: 1;
    pointer-events: all;
}

.menu-drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 85%;
    max-width: 320px;
    height: 100%;
    background: white;
    z-index: 1001;
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 2rem 1rem;
    box-shadow: 5px 0 15px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
}

.menu-drawer.active {
    transform: translateX(0);
}

.menu-header {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #f3f4f6;
}

.menu-logo {
    width: 40px;
    height: 40px;
    margin-right: 0.5rem;
    border-radius: 0.5rem;
}

.menu-title {
    font-weight: 700;
    font-size: 1.125rem;
    color: #0066FF;
}

.menu-close {
    margin-left: auto;
    font-size: 1.25rem;
    cursor: pointer;
    color: #1f2937;
    background: none;
    border: none;
    transition: transform 0.3s ease;
}

.menu-close:hover {
    transform: rotate(90deg);
}

.menu-list {
    list-style: none;
    flex: 1;
    overflow-y: auto;
    padding-right: 0.5rem;
    margin-bottom: 1rem;
}

.menu-item {
    margin-bottom: 0.5rem;
    position: relative;
    overflow: hidden;
}

.menu-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 0.75rem;
    color: #1f2937;
    text-decoration: none;
    font-weight: 500;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

.menu-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(135deg, #0066FF, #2563eb);
    z-index: -1;
    transition: width 0.3s ease;
    border-radius: 0.25rem;
}

.menu-link:hover {
    color: white;
    transform: translateX(5px);
}

.menu-link:hover::before {
    width: 100%;
}

.menu-link i {
    margin-right: 0.75rem;
    width: 24px;
    text-align: center;
    transition: all 0.3s ease;
}

.menu-link:hover i {
    transform: scale(1.2);
}

.menu-link.active {
    color: white;
    background: linear-gradient(135deg, #0066FF, #2563eb);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.menu-footer {
    padding-top: 1rem;
    border-top: 1px solid #f3f4f6;
    font-size: 0.875rem;
    color: #1f2937;
    text-align: center;
}
</style>


<script>
    // ====== Gestion du Menu Hamburger ======
const menuBtn = document.getElementById('menuBtn');
const menuOverlay = document.getElementById('menuOverlay');
const menuDrawer = document.getElementById('menuDrawer');
const menuClose = document.getElementById('menuClose');

// Fonction pour ouvrir le menu
function openMenu() {
    menuOverlay.classList.add('active');
    menuDrawer.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// Fonction pour fermer le menu
function closeMenu() {
    menuOverlay.classList.remove('active');
    menuDrawer.classList.remove('active');
    document.body.style.overflow = '';
}

// Événements
menuBtn.addEventListener('click', openMenu);
menuClose.addEventListener('click', closeMenu);
menuOverlay.addEventListener('click', closeMenu);

// Mettre en surbrillance l'élément du menu actif
document.querySelectorAll('.menu-link').forEach(link => {
    if(link.href === window.location.href) {
        link.classList.add('active');
    }
});
</script>






    <!-- Navigation flottante -->
    <nav class="floating-nav">
        <div class="nav-logo">
            <div class="nav-logo-icon">
                <i class="fas fa-shipping-fast"></i>
            </div>
            <span class="nav-title">SEND 2.0</span>
        </div>
    </nav>

    <!-- Container principal -->
    <div class="container">
        <!-- Header de recherche -->
        <header class="search-header">
            <div class="header-icon">
                <i class="fas fa-search-location"></i>
            </div>
            <h1 class="header-title">Suivi Intelligent</h1>
            <p class="header-subtitle">Localisez votre colis en temps réel avec précision GPS</p>
        </header>

        <!-- Carte de recherche -->
        <div class="search-card">
            <form id="searchForm" class="search-form">
                <div class="form-group">
                    <label for="trackingCode" class="form-label">
                        <i class="fas fa-barcode"></i>
                        Code de suivi
                    </label>
                    <input 
                        type="text" 
                        id="trackingCode" 
                        class="form-input" 
                        placeholder="Entrez votre code de suivi"
                        maxlength="20"
                        required
                        autocomplete="off"
                        spellcheck="false"
                    >
                </div>
                
                <button type="submit" id="searchBtn" class="search-btn">
                    <i class="fas fa-satellite-dish"></i>
                    <span>Localiser le colis</span>
                </button>
            </form>
        </div>

        <!-- Section des résultats -->
        <div id="resultsSection" class="results-section">
            <div class="results-container">
                <!-- Carte de statut -->
                <div class="status-card">
                    <div class="status-header">
                        <div class="status-icon">
                            <i class="fas fa-shipping-fast"></i>
                        </div>
                        <div class="status-info">
                            <h2 id="statusTitle">Statut de votre colis</h2>
                            <p class="status-description" id="statusDescription">
                                Votre colis est en cours de traitement
                            </p>
                        </div>
                    </div>
                    
                    <div class="tracking-code-display">
                        <div class="code-label">Code de suivi</div>
                        <div class="code-value" id="displayTrackingCode">XXXXXXXX</div>
                    </div>
                </div>

                <!-- Profil du livreur -->
                <div id="driverCard" class="driver-card" style="display: none;">
                    <div class="driver-header">
                        <div class="driver-header-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3>Votre livreur professionnel</h3>
                    </div>
                    
                    <div class="driver-profile">
                        <div class="driver-avatar" id="driverAvatar">
                            <div class="driver-avatar-placeholder">
                                <i class="fas fa-user"></i>
                            </div>
                        </div>
                        
                        <div class="driver-details">
                            <div class="driver-name" id="driverName">Nom du livreur</div>
                            
                            <div class="driver-info-grid" id="driverInfoGrid">
                                <!-- Les informations seront ajoutées dynamiquement -->
                            </div>
                            
                            <div class="driver-badges">
                                <span class="driver-badge verified">
                                    <i class="fas fa-shield-alt"></i>
                                    Certifié
                                </span>
                                <span class="driver-badge pro">
                                    <i class="fas fa-star"></i>
                                    Professionnel
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Carte interactive -->
                <div id="mapCard" class="map-card" style="display: none;">
                    <div class="map-header">
                        <div class="map-header-left">
                            <div class="map-header-icon">
                                <i class="fas fa-map-marked-alt"></i>
                            </div>
                            <h3>Localisation en temps réel</h3>
                        </div>
                        <div class="map-controls">
                            <button class="map-control-btn active" onclick="switchMapType('satellite')" data-type="satellite">
                                <i class="fas fa-satellite"></i>
                                Satellite
                            </button>
                            <button class="map-control-btn" onclick="switchMapType('roadmap')" data-type="roadmap">
                                <i class="fas fa-map"></i>
                                Carte
                            </button>
                            <button class="map-control-btn" onclick="toggleFullscreenMap()" id="fullscreenBtn">
                                <i class="fas fa-expand"></i>
                                Plein écran
                            </button>
                        </div>
                    </div>

                    <div id="interactiveMap"></div>

                    <div class="map-legend">
                        <div class="legend-item">
                            <div class="legend-marker sender"></div>
                            <span>Expéditeur</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-marker receiver"></div>
                            <span>Destinataire</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-marker driver"></div>
                            <span>Livreur</span>
                        </div>
                    </div>
                </div>

                <!-- Grille d'informations -->
                <div class="info-grid" id="infoGrid">
                    <!-- Les cartes d'informations seront ajoutées dynamiquement -->
                </div>

                <!-- Timeline -->
                <div class="timeline-card">
                    <div class="timeline-header">
                        <div class="timeline-header-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3>Chronologie de livraison</h3>
                    </div>
                    
                    <div class="timeline" id="timeline">
                        <!-- Les éléments de timeline seront ajoutés dynamiquement -->
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div class="action-buttons" id="actionButtons">
                    <!-- Les boutons seront ajoutés dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Message d'erreur -->
        <div id="errorCard" class="error-card">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="error-title" id="errorTitle">Colis introuvable</h3>
            <p class="error-message" id="errorMessage">
                Le code de suivi que vous avez saisi est invalide ou le colis n'existe pas dans notre système.
            </p>
            <button onclick="resetSearch()" class="action-btn">
                <i class="fas fa-search"></i>
                Nouvelle recherche
            </button>
        </div>
    </div>

    <!-- Overlay de chargement -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner-large"></div>
        <div class="loading-message" id="loadingMessage">Recherche en cours</div>
        <div class="loading-submessage" id="loadingSubmessage">
            Récupération des données de suivi...
        </div>
    </div>

    <!-- Modal pour photo en plein écran -->
    <div id="imageModal" class="image-modal-overlay" style="display: none;">
        <div class="image-modal-content">
            <img id="modalImage" src="" alt="Photo livreur" />
            <span class="close-button" onclick="closeImageModal()">&times;</span>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            apiEndpoint: 'https://send20.netlify.app/.netlify/functions/suivre-expedition',
            refreshInterval: 300000, // 5 minutes
            mapDefaultCenter: [12.3714, -1.5197], // Ouagadougou
            animationDuration: 400
        };

        // État global
        let appState = {
            currentTrackingData: null,
            mapInstance: null,
            refreshTimer: null,
            isLoading: false
        };

        // Éléments DOM
        const elements = {
            searchForm: document.getElementById('searchForm'),
            searchBtn: document.getElementById('searchBtn'),
            trackingCode: document.getElementById('trackingCode'),
            resultsSection: document.getElementById('resultsSection'),
            errorCard: document.getElementById('errorCard'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            loadingMessage: document.getElementById('loadingMessage'),
            loadingSubmessage: document.getElementById('loadingSubmessage'),
            statusTitle: document.getElementById('statusTitle'),
            statusDescription: document.getElementById('statusDescription'),
            displayTrackingCode: document.getElementById('displayTrackingCode'),
            driverCard: document.getElementById('driverCard'),
            driverAvatar: document.getElementById('driverAvatar'),
            driverName: document.getElementById('driverName'),
            driverInfoGrid: document.getElementById('driverInfoGrid'),
            infoGrid: document.getElementById('infoGrid'),
            timeline: document.getElementById('timeline'),
            mapCard: document.getElementById('mapCard'),
            actionButtons: document.getElementById('actionButtons'),
            errorTitle: document.getElementById('errorTitle'),
            errorMessage: document.getElementById('errorMessage'),
            imageModal: document.getElementById('imageModal'),
            modalImage: document.getElementById('modalImage')
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        function initializeApp() {
            console.log('🚀 Initialisation SEND 2.0 Suivi Ultra-Sophistiqué');
            setupEventListeners();
            checkUrlForTrackingCode();
        }

        function toggleFullscreenMap() {
            const mapCard = document.querySelector('.map-card');
            const fullscreenBtn = document.getElementById('fullscreenBtn');

            const isFullscreen = mapCard.classList.contains('fullscreen');

            if (!isFullscreen) {
                // Plein écran activé
                mapCard.classList.add('fullscreen');
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> Réduire';

                // Ajouter un bouton de fermeture s'il n'existe pas déjà
                if (!document.getElementById('closeFullscreenBtn')) {
                    const closeBtn = document.createElement('button');
                    closeBtn.className = 'map-control-btn';
                    closeBtn.id = 'closeFullscreenBtn';
                    closeBtn.innerHTML = '<i class="fas fa-times"></i> Fermer';
                    closeBtn.style.position = 'absolute';
                    closeBtn.style.right = '24px';
                    closeBtn.style.top = '24px';
                    closeBtn.style.zIndex = '1002';
                    closeBtn.onclick = toggleFullscreenMap;
                    mapCard.appendChild(closeBtn);
                }

            } else {
                // Sortie du plein écran
                mapCard.classList.remove('fullscreen');
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> Plein écran';

                const closeBtn = document.getElementById('closeFullscreenBtn');
                if (closeBtn) closeBtn.remove();
            }

            // Réinitialiser la taille de la carte
            setTimeout(() => {
                if (appState.mapInstance) {
                    appState.mapInstance.invalidateSize();
                    if (appState.currentTrackingData) {
                        fitMapBounds(appState.currentTrackingData);
                    }
                }
            }, 200);
        }

        function openImageModal(imageUrl, altText = 'Photo livreur') {
            elements.modalImage.src = imageUrl;
            elements.modalImage.alt = altText;
            elements.imageModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            elements.imageModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Gérer aussi le plein écran via la touche Echap
        document.addEventListener('keydown', (e) => {
            const mapCard = document.querySelector('.map-card');
            if (mapCard.classList.contains('fullscreen') && e.key === 'Escape') {
                toggleFullscreenMap();
            }
            
            // Fermer le modal d'image avec Echap
            if (elements.imageModal.style.display === 'flex' && e.key === 'Escape') {
                closeImageModal();
            }
        });

        // Fermer modal en cliquant à l'extérieur
        elements.imageModal.addEventListener('click', (e) => {
            if (e.target === elements.imageModal) {
                closeImageModal();
            }
        });

        function setupEventListeners() {
            elements.searchForm.addEventListener('submit', handleSearch);
            elements.trackingCode.addEventListener('input', handleInput);
            
            // Auto-recherche si code en URL
            window.addEventListener('popstate', checkUrlForTrackingCode);
            
            // Gestion hors ligne
            window.addEventListener('online', handleOnlineStatus);
            window.addEventListener('offline', handleOfflineStatus);
        }

        function handleInput(e) {
            const value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            e.target.value = value;
            
            // Validation visuelle
            if (validateTrackingCode(value)) {
                e.target.style.borderColor = 'var(--success)';
                e.target.style.boxShadow = '0 0 0 4px rgba(34, 197, 94, 0.15)';
            } else {
                e.target.style.borderColor = 'var(--gray-200)';
                e.target.style.boxShadow = '';
            }
        }

        function validateTrackingCode(code) {
            return code && code.length >= 4 && code.length <= 20 && /^[A-Z0-9]+$/.test(code);
        }

        async function handleSearch(e) {
            e.preventDefault();
            
            const trackingCode = elements.trackingCode.value.trim();
            
            if (!validateTrackingCode(trackingCode)) {
                showError('Code de suivi invalide', 'Veuillez saisir un code valide (4-20 caractères alphanumériques)');
                animateError();
                return;
            }

            await performSearch(trackingCode);
        }

        async function performSearch(code) {
            if (appState.isLoading) return;
            
            try {
                appState.isLoading = true;
                showLoading('Recherche en cours', 'Récupération des données de suivi...');
                setButtonLoading(true);
                hideResults();
                hideError();
                
                updateUrl(code);
                
                const response = await fetch(CONFIG.apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({ codeID: code })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `Erreur HTTP ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Erreur lors de la récupération des données');
                }

                if (result.message && !result.expedition) {
                    showPendingMessage(result.message);
                    return;
                }

                if (!result.expedition) {
                    throw new Error('Aucune donnée de suivi trouvée');
                }

                appState.currentTrackingData = result.expedition;
                await displayResults(result.expedition);
                startAutoRefresh(code);
                showToast('Données récupérées avec succès', 'success');

            } catch (error) {
                console.error('❌ Erreur de recherche:', error);
                handleSearchError(error);
            } finally {
                appState.isLoading = false;
                hideLoading();
                setButtonLoading(false);
            }
        }

        function showPendingMessage(message) {
            showError('Colis en attente', message);
        }

        async function displayResults(data) {
            console.log('📦 Affichage des résultats:', data);

            // Mise à jour du statut
            updateStatusCard(data);
            
            // Mise à jour du profil du livreur
            updateDriverCard(data);
            
            // Mise à jour des informations
            updateInfoGrid(data);
            
            // Mise à jour de la timeline
            updateTimeline(data);
            
            // Mise à jour de la carte
            updateMap(data);
            
            // Mise à jour des boutons d'action
            updateActionButtons(data);
            
            // Affichage des résultats avec animation
            showResults();
        }

function updateStatusCard(data) {
    const statusMap = {
        'en_attente': {
            title: 'Commande acceptée – En attente d\'un livreur',
            description: 'Votre commande a été validée. Un livreur vous sera bientôt assigné.',
            icon: 'fas fa-hourglass-half',
            template: `
                <div class="status-template waiting-animation" style="
                    background: #fff8e1;
                    border: 1px solid #ffe082;
                    border-radius: 16px;
                    padding: 24px;
                    text-align: center;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
                    animation: fadeIn 0.6s ease-out;
                ">
                    <div class="waiting-animation-icon" style="
                        font-size: 48px;
                        color: #f57c00;
                        margin-bottom: 16px;
                    ">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <h3 style="
                        font-size: 20px;
                        color: #f57c00;
                        margin-bottom: 12px;
                    ">
                        Votre colis est en préparation
                    </h3>
                    <p style="
                        font-size: 16px;
                        color: #444;
                        line-height: 1.6;
                        margin: 0 auto;
                        max-width: 360px;
                    ">
                        Nous recherchons actuellement un livreur disponible dans votre zone.<br>
                        Vous serez notifié dès qu'un livreur aura été assigné.
                    </p>
                </div>
            `
        },
        'en_cours_de_livraison': {
            title: 'Votre colis est en route !',
            description: 'Notre livreur professionnel se dirige vers vous avec votre commande.',
            icon: 'fas fa-motorcycle',
            template: `
                <div class="status-template" style="margin-top: 20px; background: rgba(16, 185, 129, 0.05); padding: 20px; border-radius: var(--radius-xl); border-left: 4px solid var(--success);">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2rem; color: var(--success);">
                            <i class="fas fa-motorcycle"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: var(--success);">Livraison en cours</h4>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: white; border-radius: var(--radius);">
                        <p style="margin: 0; font-size: 0.9em; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle" style="color: var(--info);"></i>
                            <span>Le livreur peut être retardé par le trafic. Merci pour votre patience.</span>
                        </p>
                    </div>
                </div>
            `
        },
        'livre': {
            title: 'Livraison réussie !',
            description: 'Votre colis a été livré avec succès à destination.',
            icon: 'fas fa-check-circle',
            template: `
                <div class="status-template" style="margin-top: 20px; background: rgba(34, 197, 94, 0.05); padding: 20px; border-radius: var(--radius-xl); border-left: 4px solid var(--success);">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2rem; color: var(--success);">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: var(--success);">Colis livré</h4>
                            <p style="margin: 0; font-size: 0.9em;">Le ${formatDate(data?.dateLivraison ?? '')}</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: var(--radius); margin-bottom: 15px;">
                        <h5 style="margin: 0 0 10px 0; color: var(--gray-700);">Comment s'est passée votre livraison ?</h5>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="rateDelivery(5)" class="action-btn" style="flex: 1; background: var(--success); color: white;">
                                <i class="fas fa-smile"></i> Excellent
                            </button>
                            <button onclick="rateDelivery(3)" class="action-btn" style="flex: 1; background: var(--warning); color: white;">
                                <i class="fas fa-meh"></i> Moyen
                            </button>
                            <button onclick="rateDelivery(1)" class="action-btn" style="flex: 1; background: var(--danger); color: white;">
                                <i class="fas fa-frown"></i> Déçu
                            </button>
                        </div>
                    </div>
                    <p style="font-size: 0.9em; text-align: center; color: var(--gray-600);">
                        <i class="fas fa-info-circle"></i> Merci pour votre confiance. À bientôt !
                    </p>
                </div>
            `
        }
    };

    // Fallback en cas de statut inconnu
    const status = statusMap[data?.statut] ?? {
        title: 'Statut inconnu',
        description: 'État du colis non déterminé',
        icon: 'fas fa-question-circle',
        template: ''
    };

    // Mise à jour des textes principaux
    if (elements.statusTitle) elements.statusTitle.textContent = status.title;
    if (elements.statusDescription) elements.statusDescription.textContent = status.description;
    if (elements.displayTrackingCode) elements.displayTrackingCode.textContent = data?.colisID ?? '';

    // Mise à jour de l'icône de statut
    const statusIcon = document.querySelector('.status-icon');
    if (statusIcon) {
        statusIcon.className = `status-icon ${data?.statut}`;
        statusIcon.innerHTML = `<i class="${status.icon}"></i>`;
    }

    // Mise à jour du contenu visuel dynamique
    const statusInfo = document.querySelector('.status-info');
    if (statusInfo) {
        const existingTemplate = statusInfo.querySelector('.status-template');
        if (existingTemplate) existingTemplate.remove();

        if (status.template) {
            const wrapper = document.createElement('div');
            wrapper.innerHTML = status.template;
            const content = wrapper.firstElementChild;
            if (content) statusInfo.appendChild(content);
        }
    }
}

        function rateDelivery(rating) {
            // Envoyer l'évaluation au serveur
            showToast(`Merci pour votre évaluation (${rating}/5)`, 'success');
        }

        function updateDriverCard(data) {
            if (!data.livreurInfo && !data.nomLivreur) {
                elements.driverCard.style.display = 'none';
                return;
            }

            elements.driverCard.style.display = 'block';
            
            const livreur = data.livreurInfo || {};
            const driverName = livreur.nom || data.nomLivreur || 'Livreur non spécifié';
            
            elements.driverName.textContent = driverName;
            
            // Gestion de la photo du livreur
            updateDriverAvatar(livreur);
            
            // Mise à jour des informations du livreur
            updateDriverInfo(data);
        }

        function updateDriverAvatar(livreur) {
            const avatarContainer = elements.driverAvatar;
            avatarContainer.innerHTML = '';

            // Essayer d'abord avec photoBase64
            if (livreur.photoBase64) {
                const img = document.createElement('img');
                img.onload = () => {
                    img.style.opacity = 1;
                    img.style.cursor = 'pointer';
                    img.style.transition = 'all 0.3s ease';
                    img.onclick = () => openImageModal(livreur.photoBase64, `Photo de ${livreur.nom || 'livreur'}`);
                    avatarContainer.appendChild(img);
                };
                img.onerror = () => showInitialsAvatar(livreur);
                
                img.style.opacity = 0;
                img.style.transition = 'opacity 0.3s';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '50%';
                img.src = livreur.photoBase64;
                img.alt = `Photo de ${livreur.nom || 'livreur'}`;
                img.title = 'Cliquez pour agrandir';
                return;
            }
            
            // Fallback aux initiales si pas de photo
            showInitialsAvatar(livreur);

            console.log('Structure complète du livreur:', JSON.stringify(livreur, null, 2));
        }

        function showInitialsAvatar(livreur) {
            const initials = getInitials(livreur.nom || livreur.prenom || 'L');
            const colors = ['#667eea', '#764ba2', '#6B46C1', '#553C9A'];
            const color = colors[initials.charCodeAt(0) % colors.length];
            
            elements.driverAvatar.innerHTML = `
                <div class="driver-avatar-placeholder" style="background: ${color}; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 2rem; width: 100%; height: 100%; border-radius: 50%;">
                    ${initials}
                </div>
            `;
        }

        function getInitials(name) {
            return name.split(' ')
                .map(part => part[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
        }

        function updateDriverInfo(data) {
            const livreur = data.livreurInfo || {};
            const infoItems = [];

            // ID du livreur
            if (livreur.id || data.idLivreurEnCharge) {
                infoItems.push({
                    icon: 'fas fa-id-card',
                    label: 'ID Livreur',
                    value: livreur.id || data.idLivreurEnCharge
                });
            }

            // Téléphone principal
            const mainPhone = livreur.telephone || data.telephoneLivreur1 || data.driverPhone1;
            if (mainPhone) {
                infoItems.push({
                    icon: 'fas fa-phone',
                    label: 'Téléphone',
                    value: `<a href="tel:${mainPhone}" style="color: var(--primary); text-decoration: none;">${mainPhone}</a>`
                });
            }

            // WhatsApp
            if (livreur.whatsapp) {
                infoItems.push({
                    icon: 'fab fa-whatsapp',
                    label: 'WhatsApp',
                    value: `<a href="https://wa.me/${livreur.whatsapp.replace(/[^\d]/g, '')}" style="color: var(--success); text-decoration: none;" target="_blank">${livreur.whatsapp}</a>`
                });
            }

            // Quartier
            if (livreur.quartier) {
                infoItems.push({
                    icon: 'fas fa-map-marker-alt',
                    label: 'Quartier',
                    value: livreur.quartier
                });
            }

            elements.driverInfoGrid.innerHTML = infoItems.map(item => `
                <div class="driver-info-item">
                    <div class="driver-info-icon">
                        <i class="${item.icon}"></i>
                    </div>
                    <div class="driver-info-content">
                        <div class="driver-info-label">${item.label}</div>
                        <div class="driver-info-value">${item.value}</div>
                    </div>
                </div>
            `).join('');
        }

        function updateInfoGrid(data) {
            const infoCards = [
                {
                    title: 'Informations du colis',
                    icon: 'fas fa-cube',
                    items: [
                        { label: 'Code de suivi', value: data.colisID, class: 'code' },
                        { label: 'Type', value: data.colis?.type || 'Non spécifié' },
                        { label: 'Description', value: data.colis?.description || 'Non spécifiée' },
                        { label: 'Date de création', value: formatDate(data.dateCreation) }
                    ]
                },
                {
                    title: 'Informations de livraison',
                    icon: 'fas fa-truck',
                    items: [
                        { label: 'Expéditeur', value: data.expediteur?.nom || 'Non spécifié' },
                        { label: 'Destinataire', value: data.destinataire?.nom || 'Non spécifié' },
                        { label: 'Adresse', value: data.destinataire?.adresse || 'Non spécifiée' },
                        { label: 'Prix de livraison', value: data.prixLivraison ? `${data.prixLivraison} FCFA` : 'Non défini' }
                    ]
                }
            ];

            elements.infoGrid.innerHTML = infoCards.map(card => `
                <div class="info-card">
                    <div class="info-card-header">
                        <div class="info-card-icon">
                            <i class="${card.icon}"></i>
                        </div>
                        <h3 class="info-card-title">${card.title}</h3>
                    </div>
                    <div class="info-items">
                        ${card.items.map(item => `
                            <div class="info-item">
                                <span class="info-label">${item.label}</span>
                                <span class="info-value ${item.class || ''}">${item.value}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function updateTimeline(data) {
            const timelineItems = generateTimelineItems(data);
            
            elements.timeline.innerHTML = timelineItems.map((item, index) => `
                <div class="timeline-item" style="animation-delay: ${index * 0.1}s">
                    <div class="timeline-marker ${item.status}">
                        <i class="${item.icon}"></i>
                    </div>
                    <div class="timeline-content">
                        <h4 class="timeline-title">${item.title}</h4>
                        <p class="timeline-description">${item.description}</p>
                        <div class="timeline-date">${item.date}</div>
                    </div>
                </div>
            `).join('');
        }

        function generateTimelineItems(data) {
            const items = [];

            // Création du colis
            if (data.dateCreation) {
                items.push({
                    title: 'Colis créé',
                    description: 'Votre colis a été enregistré dans notre système avec succès.',
                    date: formatDate(data.dateCreation),
                    icon: 'fas fa-plus-circle',
                    status: 'completed'
                });
            }

            // Acceptation par le livreur
            if (data.dateAcceptation) {
                items.push({
                    title: 'Prise en charge',
                    description: 'Le colis a été accepté par notre livreur professionnel.',
                    date: formatDate(data.dateAcceptation),
                    icon: 'fas fa-hand-holding',
                    status: 'completed'
                });
            }

            // Statut actuel
            if (data.statut === 'en_cours_de_livraison') {
                items.push({
                    title: 'En cours de livraison',
                    description: 'Le colis est actuellement en transit vers sa destination.',
                    date: 'En cours',
                    icon: 'fas fa-truck',
                    status: 'current'
                });
            }

            // Livraison (future)
            items.push({
                title: 'Livraison',
                description: 'Le colis sera livré à sa destination finale.',
                date: 'À venir',
                icon: 'fas fa-flag-checkered',
                status: data.statut === 'livre' ? 'completed' : 'pending'
            });

            return items;
        }

        function updateMap(data) {
            if (!hasLocationData(data)) {
                elements.mapCard.style.display = 'none';
                return;
            }

            elements.mapCard.style.display = 'block';
            
            // Initialiser la carte après un court délai pour s'assurer que l'élément est visible
            setTimeout(() => {
                initializeMap(data);
            }, 500);
        }

        function hasLocationData(data) {
            return data.driverLocation || data.expediteur?.location || data.destinataire?.location;
        }

        function initializeMap(data) {
            const mapElement = document.getElementById('interactiveMap');
            if (!mapElement) return;

                    // Déterminer le centre de la carte
                    let center = CONFIG.mapDefaultCenter;
                    if (data.driverLocation) {
                        center = [data.driverLocation.latitude, data.driverLocation.longitude];
                    } else if (data.destinataire?.location) {
                        center = [data.destinataire.location.latitude, data.destinataire.location.longitude];
                    }

                    // Initialiser la carte
                    if (appState.mapInstance) {
                        appState.mapInstance.remove();
                    }

                    appState.mapInstance = L.map('interactiveMap', {
                        zoomControl: false,
                        attributionControl: false
                    }).setView(center, 13);

                    // Ajouter le contrôle de zoom
                    L.control.zoom({ position: 'topright' }).addTo(appState.mapInstance);

                    // Ajouter les tuiles satellite par défaut
                    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        maxZoom: 19,
                        attribution: 'Tiles © Esri'
                    }).addTo(appState.mapInstance);

                    // Ajouter les marqueurs
                    addMapMarkers(data);
                    
                    // Ajuster la vue pour inclure tous les marqueurs
                    fitMapBounds(data);

                    // Gérer le redimensionnement de la fenêtre
            window.addEventListener('resize', () => {
                if (appState.mapInstance) {
                    setTimeout(() => {
                        appState.mapInstance.invalidateSize();
                        if (appState.currentTrackingData) {
                            fitMapBounds(appState.currentTrackingData);
                        }
                    }, 100);
                }
            });
        }
                
        function addMapMarkers(data) {
            const bounds = [];

            // Marqueur expéditeur
            if (data.expediteur?.location) {
                const marker = L.marker([data.expediteur.location.latitude, data.expediteur.location.longitude], {
                    icon: createCustomIcon('#3B82F6', 'fas fa-paper-plane')
                }).addTo(appState.mapInstance);
                
                marker.bindPopup(`
                    <div style="text-align: center; padding: 10px;">
                        <h3 style="margin: 0 0 5px 0; color: #3B82F6;"><i class="fas fa-paper-plane"></i> Expéditeur</h3>
                        <p style="margin: 0; font-weight: 600;">${data.expediteur.nom || 'Non spécifié'}</p>
                    </div>
                `);
                bounds.push([data.expediteur.location.latitude, data.expediteur.location.longitude]);
            }

            // Marqueur destinataire
            if (data.destinataire?.location) {
                const marker = L.marker([data.destinataire.location.latitude, data.destinataire.location.longitude], {
                    icon: createCustomIcon('#22C55E', 'fas fa-home')
                }).addTo(appState.mapInstance);
                
                marker.bindPopup(`
                    <div style="text-align: center; padding: 10px;">
                        <h3 style="margin: 0 0 5px 0; color: #22C55E;"><i class="fas fa-home"></i> Destinataire</h3>
                        <p style="margin: 0; font-weight: 600;">${data.destinataire.nom || 'Non spécifié'}</p>
                    </div>
                `);
                bounds.push([data.destinataire.location.latitude, data.destinataire.location.longitude]);
            }

            // Marqueur livreur
            if (data.driverLocation) {
                const marker = L.marker([data.driverLocation.latitude, data.driverLocation.longitude], {
                    icon: createCustomIcon('#F59E0B', 'fas fa-motorcycle', true)
                }).addTo(appState.mapInstance);
                
                marker.bindPopup(`
                    <div style="text-align: center; padding: 10px;">
                        <h3 style="margin: 0 0 5px 0; color: #F59E0B;"><i class="fas fa-motorcycle"></i> Livreur</h3>
                        <p style="margin: 0; font-weight: 600;">${data.nomLivreur || data.livreurInfo?.nom || 'Non spécifié'}</p>
                        <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #666;">Position en temps réel</p>
                    </div>
                `);
                bounds.push([data.driverLocation.latitude, data.driverLocation.longitude]);
            }

            // Tracer l'itinéraire si possible
            if (data.driverLocation && data.destinataire?.location) {
                L.polyline([
                    [data.driverLocation.latitude, data.driverLocation.longitude],
                    [data.destinataire.location.latitude, data.destinataire.location.longitude]
                ], {
                    color: '#22C55E',
                    weight: 4,
                    opacity: 0.8,
                    dashArray: '10, 5'
                }).addTo(appState.mapInstance);
            }
        }

        function createCustomIcon(color, iconClass, animated = false) {
            const pulseClass = animated ? 'style="animation: pulse 2s ease-in-out infinite;"' : '';
            return L.divIcon({
                html: `
                    <div ${pulseClass} style="
                        background: ${color}; 
                        width: 32px; 
                        height: 32px; 
                        border-radius: 50%; 
                        border: 3px solid white; 
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        position: relative;
                    ">
                        <i class="${iconClass}" style="color: white; font-size: 14px;"></i>
                    </div>
                `,
                className: 'custom-marker',
                iconSize: [32, 32],
                iconAnchor: [16, 16]
            });
        }

        function fitMapBounds(data) {
            const bounds = [];
            
            if (data.expediteur?.location) {
                bounds.push([data.expediteur.location.latitude, data.expediteur.location.longitude]);
            }
            if (data.destinataire?.location) {
                bounds.push([data.destinataire.location.latitude, data.destinataire.location.longitude]);
            }
            if (data.driverLocation) {
                bounds.push([data.driverLocation.latitude, data.driverLocation.longitude]);
            }

            if (bounds.length > 1) {
                appState.mapInstance.fitBounds(bounds, { padding: [20, 20] });
            } else if (bounds.length === 1) {
                appState.mapInstance.setView(bounds[0], 15);
            }
        }

        function switchMapType(type) {
            if (!appState.mapInstance) return;

            // Mettre à jour les boutons
            document.querySelectorAll('.map-control-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });

            // Supprimer les tuiles existantes
            appState.mapInstance.eachLayer(layer => {
                if (layer instanceof L.TileLayer) {
                    appState.mapInstance.removeLayer(layer);
                }
            });

            // Ajouter les nouvelles tuiles
            if (type === 'satellite') {
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    maxZoom: 19,
                    attribution: 'Tiles © Esri'
                }).addTo(appState.mapInstance);
            } else {
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© OpenStreetMap contributors'
                }).addTo(appState.mapInstance);
            }
        }

        function updateActionButtons(data) {
            const buttons = [];

            // Localiser l'expéditeur
            if (data.expediteur?.location) {
                buttons.push({
                    text: 'Localiser l\'expéditeur',
                    icon: 'fas fa-map-marker-alt',
                    class: 'info',
                    href: getGoogleMapsUrl(data.expediteur.location, 'Expéditeur')
                });
            }

            // Ma position (destinataire)
            if (data.destinataire?.location) {
                buttons.push({
                    text: 'Ma position',
                    icon: 'fas fa-home',
                    class: 'success',
                    href: getGoogleMapsUrl(data.destinataire.location, 'Destinataire')
                });
            }

            // Localiser le livreur
            if (data.driverLocation) {
                buttons.push({
                    text: 'Localiser le livreur',
                    icon: 'fas fa-truck',
                    class: 'warning',
                    href: getGoogleMapsUrl(data.driverLocation, 'Livreur')
                });
            }

            // Appeler le livreur
            const driverPhone = getDriverPhone(data);
            if (driverPhone) {
                buttons.push({
                    text: 'Appeler le livreur',
                    icon: 'fas fa-phone',
                    class: 'primary',
                    href: `tel:${driverPhone}`
                });
            }

            elements.actionButtons.innerHTML = buttons.map(btn => `
                <a href="${btn.href}" target="_blank" rel="noopener" class="action-btn ${btn.class}">
                    <i class="${btn.icon}"></i>
                    ${btn.text}
                </a>
            `).join('');
        }

        function getDriverPhone(data) {
            return data.livreurInfo?.telephone || 
                   data.telephoneLivreur1 || 
                   data.driverPhone1 || 
                   data.driverPhone;
        }

        function getGoogleMapsUrl(location, label) {
            return `https://www.google.com/maps?q=${location.latitude},${location.longitude}&label=${encodeURIComponent(label)}`;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Non disponible';
            
            const date = new Date(dateString);
            return date.toLocaleString('fr-FR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showResults() {
            elements.resultsSection.classList.add('visible');
            elements.errorCard.classList.remove('visible');
            
            // Scroll vers les résultats
            setTimeout(() => {
                elements.resultsSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 300);
        }

        function hideResults() {
            elements.resultsSection.classList.remove('visible');
        }

        function showError(title, message) {
            elements.errorTitle.textContent = title;
            elements.errorMessage.textContent = message;
            elements.errorCard.classList.add('visible');
            elements.resultsSection.classList.remove('visible');
        }

        function hideError() {
            elements.errorCard.classList.remove('visible');
        }

        function showLoading(title, message) {
            elements.loadingMessage.textContent = title;
            elements.loadingSubmessage.textContent = message;
            elements.loadingOverlay.classList.add('visible');
        }

        function hideLoading() {
            elements.loadingOverlay.classList.remove('visible');
        }

        function setButtonLoading(loading) {
            if (loading) {
                elements.searchBtn.classList.add('loading');
                elements.searchBtn.innerHTML = '<div class="loading-spinner"></div><span>Recherche...</span>';
                elements.searchBtn.disabled = true;
            } else {
                elements.searchBtn.classList.remove('loading');
                elements.searchBtn.innerHTML = '<i class="fas fa-satellite-dish"></i><span>Localiser le colis</span>';
                elements.searchBtn.disabled = false;
            }
        }

        function animateError() {
            elements.trackingCode.style.animation = 'errorShake 0.6s ease-in-out';
            setTimeout(() => {
                elements.trackingCode.style.animation = '';
            }, 600);
        }

        function handleSearchError(error) {
            let title = 'Erreur de recherche';
            let message = 'Une erreur est survenue lors de la recherche';

            if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                title = 'Problème de connexion';
                message = 'Vérifiez votre connexion Internet et réessayez';
            } else if (error.message.includes('404') || error.message.includes('not found')) {
                title = 'Colis introuvable';
                message = 'Le code de suivi saisi est invalide ou le colis n\'existe pas';
            } else if (error.message.includes('timeout')) {
                title = 'Délai dépassé';
                message = 'La recherche prend trop de temps. Veuillez réessayer';
            } else if (error.message) {
                message = error.message;
            }

            showError(title, message);
            showToast(message, 'error');
        }

        function startAutoRefresh(code) {
            stopAutoRefresh();
            appState.refreshTimer = setInterval(() => {
                console.log('🔄 Auto-actualisation...');
                performSearch(code);
            }, CONFIG.refreshInterval);
        }

        function stopAutoRefresh() {
            if (appState.refreshTimer) {
                clearInterval(appState.refreshTimer);
                appState.refreshTimer = null;
            }
        }

        function updateUrl(code) {
            const url = new URL(window.location);
            url.searchParams.set('code', code);
            window.history.pushState({}, '', url);
        }

        function checkUrlForTrackingCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code && validateTrackingCode(code)) {
                elements.trackingCode.value = code;
                performSearch(code);
            }
        }

        function resetSearch() {
            elements.trackingCode.value = '';
            elements.trackingCode.focus();
            hideResults();
            hideError();
            stopAutoRefresh();
            
            // Nettoyer l'URL
            window.history.pushState({}, '', window.location.pathname);
        }

        function handleOnlineStatus() {
            showToast('Connexion rétablie', 'success');
        }

        function handleOfflineStatus() {
            showToast('Connexion perdue. Certaines fonctionnalités peuvent être limitées.', 'warning');
        }

        function showToast(message, type = 'info') {
            // Supprimer les anciens toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconMap = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="toast-icon ${iconMap[type]}"></i>
                <span class="toast-message">${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            // Auto-suppression après 5 secondes
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(-50%) translateY(100%)';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 400);
                }
            }, 5000);
        }

        // Gestion des erreurs globales
        window.addEventListener('error', (e) => {
            console.error('❌ Erreur globale:', e.error);
            showToast('Une erreur inattendue est survenue', 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('❌ Promise rejetée:', e.reason);
            showToast('Erreur de traitement des données', 'error');
        });

        // Nettoyage lors de la fermeture
        window.addEventListener('beforeunload', () => {
            stopAutoRefresh();
            if (appState.mapInstance) {
                appState.mapInstance.remove();
            }
        });

        // Fonctions globales
        window.switchMapType = switchMapType;
        window.resetSearch = resetSearch;
        window.openImageModal = openImageModal;
        window.closeImageModal = closeImageModal;

        console.log('🎉 SEND 2.0 Suivi Ultra-Sophistiqué initialisé avec succès');
    </script>
</body>

</html>